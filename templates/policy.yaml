# clanet Compliance Policy - Example
#
# This policy file contains recommended default rules.
# Copy and customize for your environment:
#
#   cp templates/policy.yaml my-policy.yaml
#   # Edit my-policy.yaml
#
# Then point to it in .clanet.yaml:
#   policy_file: ./my-policy.yaml
#
# Rule types:
#   pattern_deny   - Block if command matches this regex
#   pattern_allow  - Exception to pattern_deny
#   require        - Required pattern (global or scoped with require_on)
#   require_on     - Only check 'require' within this config section
#   require_in_running - Pattern must exist in running-config
#   recommend      - Best practice suggestion (WARN only, never blocks)
#   scope          - When to evaluate: config_commands | interface_config
#   rule           - Natural language rule for LLM evaluation
#                    (evaluated by Claude in /clanet:config, or by compliance-checker in /clanet:team)
#
# Three patterns (same as constitution.yaml):
#   pattern_deny only      → CLI checks automatically (fast, always works)
#   rule only              → LLM evaluates (/clanet:config Step 6 or /clanet:team)
#   pattern_deny + rule    → CLI does regex; LLM also does semantic reasoning

policy:
  name: clanet-default
  version: "1.0"
  description: "Default compliance policy with industry best-practice rules"

rules:
  # === Security ===
  # Rules to prevent insecure configurations
  security:
    - id: SEC-001
      name: No plaintext passwords
      severity: CRITICAL
      description: "Passwords must use encryption (type 5/7/8/9)."
      pattern_deny: 'password \S+$'
      pattern_allow: 'password \d+ \S+'

    - id: SEC-002
      name: SSH v2 required
      severity: HIGH
      description: "SSH version 2 must be enabled."
      require_in_running: 'ssh.*v(ersion)?\s*2'

  # === Operational Safety ===
  # Rules to prevent accidental outages
  safety:
    - id: SAF-001
      name: Management interface protection
      severity: CRITICAL
      description: "Management interface must not be modified or shut down."
      pattern_deny: '(no )?interface Mgmt|shutdown.*Mgmt'
      scope: config_commands

    - id: SAF-002
      name: No bulk protocol removal
      severity: CRITICAL
      description: "Removing an entire routing protocol is prohibited."
      pattern_deny: 'no router (ospf|bgp|isis|eigrp)'

    - id: SAF-003
      name: No disabling all logging
      severity: HIGH
      description: "Removing all logging destinations is prohibited."
      pattern_deny: 'no logging\b.*'
      pattern_allow: 'no logging console'
      rule: >
        Reject any configuration that would effectively disable all logging.
        Even if individual "no logging" commands are allowed (like "no logging
        console"), block if the combined effect removes all syslog server
        destinations.
      scope: config_commands

  # === Standards ===
  # Baseline configuration requirements
  standards:
    - id: STD-001
      name: NTP configured
      severity: MEDIUM
      description: "At least one NTP server must be configured."
      require_in_running: 'ntp server'

    - id: STD-002
      name: Logging configured
      severity: MEDIUM
      description: "A syslog destination must be configured."
      require_in_running: 'logging.*\d+\.\d+\.\d+\.\d+'

  # === Semantic (LLM-evaluated) ===
  # Rules requiring natural language understanding — evaluated by Claude, not regex
  semantic:
    - id: SEM-001
      name: Interface changes need description
      severity: MEDIUM
      description: "Interface changes should include a description for documentation."
      rule: >
        If any interface configuration is being applied, verify that a
        'description' command is also included for that interface. Flag
        if an interface is being configured without setting or updating
        its description.
      scope: config_commands

    - id: SEM-002
      name: Consistent naming conventions
      severity: LOW
      description: "Interface descriptions should follow site naming conventions."
      rule: >
        Interface descriptions should be meaningful and follow a consistent
        format such as "Link-to-<destination>" or "<purpose>_<circuit-id>".
        Flag descriptions that are too vague like "test", "temp", or "asdf".
      scope: config_commands

severity_levels:
  CRITICAL: "Must fix. Blocks deployment."
  HIGH: "Should fix. Requires explicit override to proceed."
  MEDIUM: "Recommended. Warning only."
  LOW: "Best practice. Informational."
